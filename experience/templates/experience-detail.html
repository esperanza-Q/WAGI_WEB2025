{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SujeongBridge</title>
  <link rel="stylesheet" href="{% static 'css/experience/experience-detail.css' %}">
</head>

<body>
  <header class="main-header">
    <div class="logo">
        <a href="{%url "home:home"%}">
            <img class="main-logo" src="{% static "img/main-logo.svg"%}"></a>
    </div>
    <nav class="main-nav">
      <ul class="main-nav-links">
        <li><a href="{% url 'experience:review_list' %}">활동 후기</a></li>
        <li><a href="{%url "jobTips:list"%}">자소서·면접·포폴</a></li>
        <li><a href="{%url "recruit:recruit_list"%}">모집</a></li>
        <li><a href="{%url "career:roadmap_home"%}">나의 로드맵</a></li>
      </ul>
    </nav>
    <div class="main-header-r">
      <a href="{%url "mypage:home"%}"><button class="header-mypage-btn" >마이페이지</button></a>
      {% if user.is_authenticated %}
        <a href="{%url "accounts:logout"%}"><button class="header-login-btn">로그아웃</button></a>
      {% else %}
        <a href="{%url "accounts:login"%}"><button class="header-login-btn">로그인</button></a>
      {% endif %}
    </div>
  </header>

  <main>
  <div class="container">

    <!-- 상단 헤더 -->
    <div class="ex-detail-header">
      <div class="ex-detail-info">
        <div class="ex-detail-title">{{ review.title }}</div>
        <span class="ex-detail-nickname">{{ review.user.display_name }}</span>

        <div class="ex-detail-bottom">
          <div class="ex-detail-sub">
            <span class="ex-detail-category">{{ review.get_category_display }}</span>
            <span class="ex-detail-period">{{ review.activity_period }}</span>
          </div>

          <div class="ex-detail-actions">
            <!-- 수정/삭제 버튼 (자기가 쓴 게시물일 때만 보이게 하면 될 듯..) -->
            {% if request.user == review.user %}
              <div class="ex-edit-delete">
                <a href="{% url 'experience:review_edit' review.id %}" class="ex-edit-btn">수정</a>
                <span class="ex-divider-line">|</span>
                <a href="{% url 'experience:review_delete' review.id %}">
                  <button class="ex-delete-btn" type="button">삭제</button>
                </a>
              </div>
            {% endif %}

            <!--공감해요 버튼 눌리면 숫자 증가, 이것도 백에서 구현할 것 같아서 form 안에다가 넣어둠-->
            <form method="POST" action="{% url 'experience:toggle_like' review.id %}" class="ex-like-form">
              {% csrf_token %}
              <button type="submit" class="ex-detail-like-btn">
                <img class="post-like-img" src="{% static 'img/like.svg' %}">
                <span class="ex-like-count">{{ like_count }}</span>
              </button>
            </form>
          </div>

        </div>

      </div>
    </div>

    <!-- 첨부 파일 있다면 표시-->
    {% if files %}
      <div class="ex-detail-files">
        <img class="ex-detail-file-img" src="{% static 'img/file.svg' %}" width="18px">
        <span class="ex-detail-file-content">
          {% for f in files %}
            {% if not f.is_image %}
              <a href="{{ f.file.url }}" target="_blank">
                {{ f.filename }}
              </a>
              {% if not forloop.last %}, {% endif %}
            {% endif %}
          {% endfor %}
        </span>
      </div>
    {% endif %}

    <!-- 이미지 + 후기 내용 -->
    <div class="ex-detail-body">

      <!-- 왼쪽: 이미지 슬라이더 -->
      <div class="ex-detail-image-box">
        <button class="ex-image-scroll-btn left">&#8592;</button>
        <div class="ex-detail-image-scroll">
          {% for f in files %}
            {% if f.is_image %}
              <img src="{{ f.file.url }}" alt="활동 이미지">
            {% endif %}
          {% endfor %}
        </div>
        <button class="ex-image-scroll-btn right">&#8594;</button>
      </div>

      <!-- 오른쪽: 후기 내용 -->
      <div class="ex-detail-text-box">
        <div class="ex-detail-text-title">후기 내용</div>
        <div class="ex-detail-text-content">
          {{ review.content }}
        </div>
      </div>

    </div>

    <div class="ex-detail-rating">
      <div class="ex-detail-rating-label">평점</div>
      <span class="ex-rating-value">{{ review.rating }}</span>
      <span class="ex-rating-divider">/</span>
      <span class="ex-rating-max">5</span>
    </div>

    <div class="ex-bottom-box">
      <div class="ex-detail-tags">
        {% for tag in review.tags.all %}
        <span class="ex-tag-item">#{{ tag.name }}</span>
        {% endfor %}
      </div>
      <!--스크랩 버튼 눌러지면 이미지 scrap.fill로 변경, 백에서 구현할 것 같아서 프론트에서는 form 태그 안에만 넣어둠-->
      <form method="POST" action="{% url 'experience:toggle_scrap' review.id %}" class="ex-scrap-form">
        {% csrf_token %}
        <button type="submit" class="ex-scrap-btn">
          {% if scrapped_by_user %}
            <img src="{% static 'img/scrap-fill.svg' %}" class="scrap-img">
          {% else %}
            <img src="{% static 'img/scrap.svg' %}" class="scrap-img">
          {% endif %}
        </button>
      </form>
    </div>

    <div class="ex-divider"></div>


    <!-- 댓글 작성 -->
    <form method="POST" action="{% url 'experience:add_comment' review.id %}" class="ex-detail-comment-box">
      {% csrf_token %}
      <textarea class="ex-detail-comment-content" name="content" placeholder="댓글 작성하기" required></textarea>
        <div class="ex-comment-btn-wrap">
          <button type="submit" class="ex-comment-submit-btn">
        보내기
      </button>
    </div>
    </form>


    <!-- 댓글 리스트 -->
    <div class="ex-comment-list">
      {% for c in comments %}
        <div class="ex-comment-item">
          <div class="ex-comment-top">
            <span class="ex-comment-nickname">{{ c.user.display_name }}</span>
            <span class="ex-comment-date">{{ c.created_at|date:"Y.m.d" }}</span>
          </div>
          <p class="ex-comment-text">
            {{ c.content }}
          </p>
        </div>
      {% endfor %}
    </div>
  </div>
</main>


  <footer class="footer">
    <p>© SSWU_WAGI 3기 CampusBridge</p>
    <p class="member">BACKEND  <br /> FRONTEND </p>
  </footer>

  <script src="{% static 'js/experience-edit.js' %}"></script>
</body>
</html>