{% extends 'base.html' %}
{% load static %}

{% block title %}SujeongBridge - 모집 목록{% endblock %}

{% block head_extra %}
  <link rel="stylesheet" href="{% static 'css/recruit/recruit-list.css' %}">
{% endblock %}

{% block content %}
  <div class="container">

   <!-- 전체 검색 + 필터 form 하나로 묶음 -->
    <form method="GET" id="filter-form" class="recruit-search-form" action="{% url 'search:search-recruit' %}">
      <!-- 검색창 -->
      <div class="recruit-search-section">
        <input 
          type="search" 
          name="q"
          value="{{ request.GET.q|default:'' }}"
          placeholder="활동명으로 검색하기"
          class="recruit-search-input"
        />

        <button type="submit" class="recruit-search-btn">
          <img src="{% static 'img/search.svg' %}" alt="검색">
        </button>
      </div>
      
      <!-- 숨겨진 값 (카테고리 / 정렬) -->
      <input type="hidden" name="category" id="filter-category" value="{{ category|default:'' }}">
      <input type="hidden" name="status" id="filter-status" value="{{ status|default:'' }}">
      <input type="hidden" name="order" id="filter-ordering" value="{{ order|default:'' }}">
      
      <!-- 필터링- 카테고리 -->
      <nav class="recruit-filter-tabs">
        <ul>
          <li><button type="button" class="tab-btn" data-category="">전체</button></li>
<li><button type="button" class="tab-btn" data-category="동아리">동아리</button></li>
<li><button type="button" class="tab-btn" data-category="공모전">공모전</button></li>
<li><button type="button" class="tab-btn" data-category="스터디">스터디</button></li>
        </ul>
      </nav>

      <!-- 필터링 - 정렬 -->
      <div class="recruit-sub-filters">
        <ul>
          <li>
            <a href="?category={{ category|urlencode }}{% if q_query %}&q={{ q_query|urlencode }}{% endif %}{% if selected_college %}&college={{ selected_college|urlencode }}{% endif %}{% if selected_department %}&department={{ selected_department|urlencode }}{% endif %}{% if selected_grade %}&grade={{ selected_grade|urlencode }}{% endif %}&order=latest" class="order-btn{% if order == 'latest' %} active{% endif %}">최신순</a>
          </li>
          <li>
            <a href="?category={{ category|urlencode }}&status=open{% if order %}&order={{ order|urlencode }}{% endif %}{% if q_query %}&q={{ q_query|urlencode }}{% endif %}{% if selected_college %}&college={{ selected_college|urlencode }}{% endif %}{% if selected_department %}&department={{ selected_department|urlencode }}{% endif %}{% if selected_grade %}&grade={{ selected_grade|urlencode }}{% endif %}" class="order-btn{% if status == 'open' %} active{% endif %}">모집중</a>
          </li>
          <li>
            <a href="?category={{ category|urlencode }}&status=closed{% if order %}&order={{ order|urlencode }}{% endif %}{% if q_query %}&q={{ q_query|urlencode }}{% endif %}{% if selected_college %}&college={{ selected_college|urlencode }}{% endif %}{% if selected_department %}&department={{ selected_department|urlencode }}{% endif %}{% if selected_grade %}&grade={{ selected_grade|urlencode }}{% endif %}" class="order-btn{% if status == 'closed' %} active{% endif %}">모집완료</a>
          </li>
        </ul>
      </div>

      <!-- 맞춤 필터링 -->
      <div class="recruit-sub-filter-row">
        <div class="recruit-custom-filter">

          <select class="recruit-filter-select" name="college">
            <option value="" {% if selected_college == '' %}selected{% endif %}>단과대 전체</option>
            <option value="공과대학" {% if selected_college == '공과대학' %}selected{% endif %}>공과대학</option>
            <option value="인문대학" {% if selected_college == '인문대학' %}selected{% endif %}>인문대학</option>
            <option value="음악대학" {% if selected_college == '음악대학' %}selected{% endif %}>음악대학</option>
            <option value="간호대학" {% if selected_college == '간호대학' %}selected{% endif %}>간호대학</option>
            <option value="미술대학" {% if selected_college == '미술대학' %}selected{% endif %}>미술대학</option>
            <option value="법과대학" {% if selected_college == '법과대학' %}selected{% endif %}>법과대학</option>
            <option value="사범대학" {% if selected_college == '사범대학' %}selected{% endif %}>사범대학</option>
            <option value="사회과학대학" {% if selected_college == '사회과학대학' %}selected{% endif %}>사회과학대학</option>
            <option value="생활산업대학" {% if selected_college == '생활산업대학' %}selected{% endif %}>생활산업대학</option>
            <option value="인문융합예술대학" {% if selected_college == '인문융합예술대학' %}selected{% endif %}>인문융합예술대학</option>
            <option value="자연과학대학" {% if selected_college == '자연과학대학' %}selected{% endif %}>자연과학대학</option>
          </select>

          <select class="recruit-filter-select" name="department">
            <option value="" {% if selected_department == '' %}selected{% endif %}>학과 전체</option>
            <option value="간호학과" {% if selected_department == '간호학과' %}selected{% endif %}>간호학과</option>
            <option value="바이오생명공학과" {% if selected_department == '바이오생명공학과' %}selected{% endif %}>바이오생명공학과</option>
            <option value="바이오식품공학과" {% if selected_department == '바이오식품공학과' %}selected{% endif %}>바이오식품공학과</option>
            <option value="바이오신약의과학부" {% if selected_department == '바이오신약의과학부' %}selected{% endif %}>바이오신약의과학부</option>
            <option value="청정신소재공학과" {% if selected_department == '청정신소재공학과' %}selected{% endif %}>청정신소재공학과</option>
            <option value="AI융합학부" {% if selected_department == 'AI융합학부' %}selected{% endif %}>AI융합학부</option>
            <option value="서비스·디자인공학과" {% if selected_department == '서비스·디자인공학과' %}selected{% endif %}>서비스·디자인공학과</option>
            <option value="융합보안공학과" {% if selected_department == '융합보안공학과' %}selected{% endif %}>융합보안공학과</option>
            <option value="컴퓨터공학과" {% if selected_department == '컴퓨터공학과' %}selected{% endif %}>컴퓨터공학과</option>
            <option value="공예과" {% if selected_department == '공예과' %}selected{% endif %}>공예과</option>
            <option value="동양화과" {% if selected_department == '동양화과' %}selected{% endif %}>동양화과</option>
            <option value="디자인과" {% if selected_department == '디자인과' %}selected{% endif %}>디자인과</option>
            <option value="서양화과" {% if selected_department == '서양화과' %}selected{% endif %}>서양화과</option>
            <option value="조소과" {% if selected_department == '조소과' %}selected{% endif %}>조소과</option>
            <option value="법학부" {% if selected_department == '법학부' %}selected{% endif %}>법학부</option>
            <option value="교육학과" {% if selected_department == '교육학과' %}selected{% endif %}>교육학과</option>
            <option value="사회교육과" {% if selected_department == '사회교육과' %}selected{% endif %}>사회교육과</option>
            <option value="유아교육과" {% if selected_department == '유아교육과' %}selected{% endif %}>유아교육과</option>
            <option value="윤리교육과" {% if selected_department == '윤리교육과' %}selected{% endif %}>윤리교육과</option>
            <option value="한문교육과" {% if selected_department == '한문교육과' %}selected{% endif %}>한문교육과</option>
            <option value="경영학과" {% if selected_department == '경영학과' %}selected{% endif %}>경영학과</option>
            <option value="경제학과" {% if selected_department == '경제학과' %}selected{% endif %}>경제학과</option>
            <option value="미디어커뮤니케이션학과" {% if selected_department == '미디어커뮤니케이션학과' %}selected{% endif %}>미디어커뮤니케이션학과</option>
            <option value="사회복지학과" {% if selected_department == '사회복지학과' %}selected{% endif %}>사회복지학과</option>
            <option value="심리학과" {% if selected_department == '심리학과' %}selected{% endif %}>심리학과</option>
            <option value="정치외교학과" {% if selected_department == '정치외교학과' %}selected{% endif %}>정치외교학과</option>
            <option value="지리학과" {% if selected_department == '지리학과' %}selected{% endif %}>지리학과</option>
            <option value="뷰티산업학과" {% if selected_department == '뷰티산업학과' %}selected{% endif %}>뷰티산업학과</option>
            <option value="소비자산업학과" {% if selected_department == '소비자산업학과' %}selected{% endif %}>소비자산업학과</option>
            <option value="스포츠과학부" {% if selected_department == '스포츠과학부' %}selected{% endif %}>스포츠과학부</option>
            <option value="의류산업학과" {% if selected_department == '의류산업학과' %}selected{% endif %}>의류산업학과</option>
            <option value="기악과" {% if selected_department == '기악과' %}selected{% endif %}>기악과</option>
            <option value="성악과" {% if selected_department == '성악과' %}selected{% endif %}>성악과</option>
            <option value="작곡과" {% if selected_department == '작곡과' %}selected{% endif %}>작곡과</option>
            <option value="국어국문학과" {% if selected_department == '국어국문학과' %}selected{% endif %}>국어국문학과</option>
            <option value="독일어문·문화학과" {% if selected_department == '독일어문·문화학과' %}selected{% endif %}>독일어문·문화학과</option>
            <option value="무용예술학과" {% if selected_department == '무용예술학과' %}selected{% endif %}>무용예술학과</option>
            <option value="문화예술경영학과" {% if selected_department == '문화예술경영학과' %}selected{% endif %}>문화예술경영학과</option>
            <option value="미디어영상연기학과" {% if selected_department == '미디어영상연기학과' %}selected{% endif %}>미디어영상연기학과</option>
            <option value="사학과" {% if selected_department == '사학과' %}selected{% endif %}>사학과</option>
            <option value="영어영문학과" {% if selected_department == '영어영문학과' %}selected{% endif %}>영어영문학과</option>
            <option value="일본어문·문화학과" {% if selected_department == '일본어문·문화학과' %}selected{% endif %}>일본어문·문화학과</option>
            <option value="중국어문·문화학과" {% if selected_department == '중국어문·문화학과' %}selected{% endif %}>중국어문·문화학과</option>
            <option value="프랑스어문·문화학과" {% if selected_department == '프랑스어문·문화학과' %}selected{% endif %}>프랑스어문·문화학과</option>
            <option value="현대실용음악학과" {% if selected_department == '현대실용음악학과' %}selected{% endif %}>현대실용음악학과</option>
            <option value="바이오헬스융합학부" {% if selected_department == '바이오헬스융합학부' %}selected{% endif %}>바이오헬스융합학부</option>
            <option value="수리통계데이터사이언스학과" {% if selected_department == '수리통계데이터사이언스학과' %}selected{% endif %}>수리통계데이터사이언스학과</option>
            <option value="화학·에너지융합학부" {% if selected_department == '화학·에너지융합학부' %}selected{% endif %}>화학·에너지융합학부</option>
            <option value="심리학과" {% if selected_department == '심리학과' %}selected{% endif %}>심리학과</option>
          </select>

          <select class="recruit-filter-select" name="grade">
            <option value="" {% if selected_grade == '' %}selected{% endif %}>학년 전체</option>
            <option value="1" {% if selected_grade == '1' %}selected{% endif %}>1학년</option>
            <option value="2" {% if selected_grade == '2' %}selected{% endif %}>2학년</option>
            <option value="3" {% if selected_grade == '3' %}selected{% endif %}>3학년</option>
            <option value="4" {% if selected_grade == '4' %}selected{% endif %}>4학년</option>
            <option value="5" {% if selected_grade == '5' %}selected{% endif %}>휴학</option>
            <option value="6" {% if selected_grade == '6' %}selected{% endif %}>졸업</option>
          </select>

          <button type="submit" class="recruit-custom-filter-btn">
            맞춤 검색
          </button>
        </div>
        <a class="recruit-write-btn" href="{% url 'recruit:recruit_post' %}">글쓰기</a>
      </div>
    </form>
    <div class="recruit-divider"></div>

    <div class="recruit-list">
      
      {% for recruit in recruits %}
      <a href="{% url 'recruit:recruit_detail' recruit.recruit_id %}" class="recruit-card-link">
        <div class="recruit-card">
          <div class="recruit-card-header">
            <div class="recruit-card-header-box">
            <div class="recruit-card-lcategory">{{ recruit.category.category_name }}</div>
            <div class="recruit-card-rcategory">{% if recruit.is_recruiting %}모집중{% else %}모집완료{% endif %}</div>
            </div>
            <div class="recruit-card-date">{{ recruit.created_at|date:"Y.m.d" }}</div>
          </div>
          <div class="recruit-card-title">{{ recruit.title }}</div>
          <div class="recruit-card-nickname">{{ recruit.user.display_name }}</div>
          <div class="recruit-card-period">~ {{ recruit.deadline|date:"Y.m.d" }}</div>
          <div class="recruit-card-footer">
            <div class="recruit-card-field">{{ recruit.field|default:"분야 미지정" }}</div>
            <div class="recruit-card-like"><img class="recruit-card-like-img" src="{% static 'img/like.svg' %}">{{ recruit.like_count }}</div>
          </div>
        </div>
      </a> 
      {% empty %}
      <div class="no-posts" style="grid-column: 1/-1; text-align: center; padding: 100px 0;">
        <p>해당하는 모집글이 없습니다.</p>
      </div>
      {% endfor %}

    </div>

    <!-- 페이지네이션 -->
    <div class="recruit-pagination">
      {% if recruits.has_previous %}
        <button class="recruit-page-btn" onclick="location.href='?page={{ recruits.previous_page_number }}{% if category %}&category={{ category }}{% endif %}{% if status %}&status={{ status }}{% endif %}{% if order %}&order={{ order }}{% endif %}'">&lt;</button>
      {% else %}
        <button class="recruit-page-btn" disabled style="opacity: 0.5; cursor: default;">&lt;</button>
      {% endif %}

      {% for num in recruits.paginator.page_range %}
        {% if recruits.number == num %}
          <button class="recruit-page-btn active">{{ num }}</button>
        {% elif num > recruits.number|add:'-3' and num < recruits.number|add:'3' %}
          <button class="recruit-page-btn" onclick="location.href='?page={{ num }}{% if category %}&category={{ category }}{% endif %}{% if status %}&status={{ status }}{% endif %}{% if order %}&order={{ order }}{% endif %}'">{{ num }}</button>
        {% endif %}
      {% endfor %}

      {% if recruits.has_next %}
        <button class="recruit-page-btn" onclick="location.href='?page={{ recruits.next_page_number }}{% if category %}&category={{ category }}{% endif %}{% if status %}&status={{ status }}{% endif %}{% if order %}&order={{ order }}{% endif %}'">&gt;</button>
      {% else %}
        <button class="recruit-page-btn" disabled style="opacity: 0.5; cursor: default;">&gt;</button>
      {% endif %}
    </div>
  </div>
{% endblock %}

{% block scripts %}
  <script src="{% static 'js/board-list.js' %}"></script>
{% endblock %}


