{% extends 'base.html' %}
{% load static %}

{% block title %}SujeongBridge | QnA 상세{% endblock %}

{% block head_extra %}
  <link rel="stylesheet" href="{% static 'css/otherQnA-detail.css' %}">
{% endblock %}

{% block content %}
  <div class="otherQnA-detail-wrapper">
    <div class="otherQnA-detail-top">
      <div class="otherQnA-detail-title">
        {{ qna.title }}
      </div>

      <div class="otherQnA-detail-info">
        <span class="otherQnA-detail-userId">
          {% if qna.display_name %}
            {{ qna.display_name }}
          {% elif qna.sender %}
            {{ qna.sender.display_name }}
          {% else %}
            알 수 없음
          {% endif %}
        </span>
        <span class="otherQnA-detail-date">
          {{ qna.created_at|date:"Y-m-d H:i" }}
        </span>
      </div>
    </div>

    <div class="otherQnA-detail-question">
      <p>{{ qna.content }}</p>
    </div>

    {% if answers %}
      <div class="otherQnA-detail-bottom">
        <div>ㄴ 답변</div>
        <div class="otherQnA-detail-answer">
          {% for a in answers %}
            <p>{{ a.content }}</p>
          {% endfor %}
        </div>
      </div>
    {% endif %}

    <div style="display:flex; justify-content:space-between; align-items:center; margin-top:10px;">
      <a href="{% url 'mypage:home' %}" class="otherQnA-detail-back-btn">← 돌아가기</a>

      {% if can_answer %}
        <button id="openModalBtn" type="button" class="header-login-btn" style="padding: 8px 14px;">
          답변하기
        </button>
      {% endif %}

      <div style="width: 60px;"></div>
    </div>

  </div>

  <div id="answerModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.35); z-index:2000;">
    <div style="
      max-width: 560px;
      margin: 120px auto;
      background: rgba(255,255,255,0.95);
      border: 1px solid rgba(146, 130, 161, 0.3);
      border-radius: 16px;
      padding: 18px;
      backdrop-filter: blur(10px);
    ">
      <div style="display:flex; justify-content:flex-end;">
        <button id="closeModalBtn" type="button"
                style="border:none; background:none; font-size:22px; cursor:pointer;">
          ×
        </button>
      </div>

      <h3 style="margin-top:0; color: var(--purple-dark);">답변 하기</h3>

      <form method="POST" action="{% url 'qna:answer' qna.id %}">
        {% csrf_token %}
        <textarea name="content" rows="6" style="width:100%; box-sizing:border-box;" required></textarea>
        <div style="display:flex; justify-content:flex-end; margin-top:10px;">
          <button type="submit" class="header-login-btn" style="padding: 8px 14px;">확인</button>
        </div>
      </form>
    </div>
  </div>
{% endblock %}

{% block scripts %}
  <script>
  (function () {
    const modal = document.getElementById("answerModal");
    const openBtn = document.getElementById("openModalBtn");
    const closeBtn = document.getElementById("closeModalBtn");

    function openModal() {
      if (!modal) return;
      modal.style.display = "block";
    }

    function closeModal() {
      if (!modal) return;
      modal.style.display = "none";
    }

    if (openBtn) openBtn.addEventListener("click", openModal);
    if (closeBtn) closeBtn.addEventListener("click", closeModal);

    if (modal) {
      modal.addEventListener("click", function (e) {
        if (e.target === modal) closeModal();
      });
    }

    document.addEventListener("keydown", function (e) {
      if (e.key === "Escape") closeModal();
    });
  })();
  </script>
{% endblock %}
